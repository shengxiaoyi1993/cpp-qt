# 多电脑计算框架设计


## 整体设计

- 主控程序
  - 解读源数据
  - 控制计算任务的分发
  - 客户程序处理结果的汇总
  - 拼接任务记录和进度查询
- 客户端
  - 根据主控程序提供的信息，获取资源文件，选取算法，进行计算任务


## 需要的技术
- 电脑间资源标识
- 电脑间数据传输
- 进程间数据通信
- win10与centos下程序跨平台编译


## 过程简述
- 主控程序解读源数据，分解任务
- 打开客户端程序，处于待机状态
- 主控程序配置客户端
- 主控程序询问哪一客户端处于空闲状态，客户端回复其状态
- 主控程序向空闲客户端发送任务（标明dst src 任务类型 资源 资源列表等）
- 客户端获悉任务，向请求资源
- 客户端检查资源完整性，然后执行任务
- 客户端发送任务执行结果状态（包括是否成功 dst src 资源文件路径等）
- 服务器向客户端请求资源
- 服务器将资源保存在对应路径，更新拼接进度
- 完成拼接

## 架构
- 客户端被动接收主控程序分配的任务，当有空闲线程时就检索是否有未执行的任务，请求相应的资源，然后执行；若没有任务，就等待
- 主控制程序轮询客户端的工作状态状态，总线程数和等待任务数，管理系统的资源的配置，是运行效率的在关键步骤
- 两者之间可以通过broadcast模块相互发现

### Server架构

- 数据
  - 初始化任务列表
  - 客户端列表（客户端有关的信息/线程数量/是否空闲/正在工作项目/）
  - 结果/进度管理
  - 通讯模块
  - 线程间通讯模块

- 界面
  - 源文件选择
  - 储存路径选择
  - 配置客户端
  - 客户端实时状态显示
  - 拼接进度显示


### client架构


- 数据
  - 服务器列表
  - 工作线程/线程总数
  - 正在执行的任务/等待执行的任务列表

- 界面
  - 设置总线程数
  - 启动监听与执行任务


## 实现步骤
- C/S骨架
  - 客户端与服务端可以使用同一个com模块

## TIP
- 设置共用数据结构文档
- 数据结构统一继承自易用CJSON的接口
- 使用的函数需要进行可用性测试（异常崩溃，线程安全）
- 算法部分可以编译成动态库进行调用


## FAQ
- 是否需要多进程通讯
  - 之前考虑的是使用URL仿式获取资源，该方式需要与应用进行多进程通讯
  - 当前可以不用该方式进行通信，只用多线程就行
  - client 与server的com模块是否是同一个
